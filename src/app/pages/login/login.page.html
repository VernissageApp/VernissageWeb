<div class="padding-top-30" @fadeIn>
    <div class="flex-row flex-center">
        <div class="login-container margin-left-10 margin-right-10">
            <!-- Sign in via username and password. -->
            <form name="form" (ngSubmit)="f.form.valid && onSubmit()" #f="ngForm" novalidate>
                <mat-card appearance="outlined">
                    <mat-card-header>
                        <mat-card-title>Log in to Vernissage</mat-card-title>
                        <mat-card-subtitle>Enter your credentials to sign in to the system</mat-card-subtitle>
                    </mat-card-header>
                    <mat-card-content>
                        <div class="login-content">
                            @if (loginMode === LoginMode.UserNameAndPassword) {
                                <!-- Username. -->
                                <mat-form-field appearance="outline">
                                    <mat-label>Username or email</mat-label>
                                    <input matInput [errorStateMatcher]="dirtyErrorStateMatcher" name="userNameOrEmail" [(ngModel)]="login.userNameOrEmail" #userNameOrEmail="ngModel" type="text" placeholder="Username or email" aria-label="Username or email" required />
                                    <mat-error *ngIf="userNameOrEmail.dirty && userNameOrEmail.invalid && userNameOrEmail.errors?.required">Enter username or email.</mat-error>
                                </mat-form-field>

                                <!-- Password. -->
                                <div class="text-right">
                                    <a routerLink="/forgot-password">Forgot password?</a>
                                </div>
                                <mat-form-field appearance="outline">
                                    <mat-label>Password</mat-label>
                                    <input matInput [errorStateMatcher]="dirtyErrorStateMatcher" name="password" [(ngModel)]="login.password" #password="ngModel" type="password" placeholder="Password" aria-label="Password" required />
                                    <mat-error *ngIf="password.dirty && password.invalid && password.errors?.required">Enter password.</mat-error>
                                </mat-form-field>
                            }
                            @else {
                                <!-- Token 2FA. -->
                                <mat-form-field appearance="outline" class="margin-bottom-20">
                                    <mat-label>Token</mat-label>
                                    <input matInput [errorStateMatcher]="alwaysErrorStateMatcher" inputmode="numeric" name="token" [(ngModel)]="twoFactorToken" #twoFactorTokenInput="ngModel" type="text" placeholder="Two factor token" aria-label="Two factor token" required />
                                    <mat-error *ngIf="tokenMessge">{{ tokenMessge }}</mat-error>
                                </mat-form-field>
                            }
                        </div>
                    </mat-card-content>
                    <mat-card-actions>
                        <div class="flex-row login-actions">
                            @if (loginMode === LoginMode.TwoFactorToken) {
                                <button type="button" mat-stroked-button (click)="onCancelTwoFactor()" [disabled]="isSubmitting" class="margin-right-5" aria-label="Cancel">Cancel</button>
                            }
                            <button type="submit" mat-flat-button [disabled]="isSubmitting" color="primary" aria-label="Login">Login</button>
                            <mat-spinner *ngIf="isSubmitting" [diameter]="18" class="margin-left-10 margin-top-5"></mat-spinner>
                            <div *ngIf="errorMessage" class="mat-small text-error margin-left-10 margin-top-10">{{ errorMessage }}</div>
                        </div>
                    </mat-card-actions>
                    <mat-card-footer *ngIf="isRegistrationEnabled()">
                        <!-- Register new account. -->
                        <div class="text-center">
                            <p>You don't have an account yet? <a routerLink="/register">Sign up</a>.</p>
                        </div>
                    </mat-card-footer>
                </mat-card>
            </form>

            <!-- Sign in via external account. -->
            <div *ngIf="authClients && authClients.length > 0" class="separator margin-top-20 margin-bottom-20">Or via Social Account</div>
            <div class="external-sign-in">
                <div *ngFor="let authClient of authClients">
                    <a [href]="getExternalProviderUrl(authClient)" type="button" mat-flat-button color="basic">
                        <div *ngIf="authClient.svgIcon" class='icon' [innerHTML]="authClient.svgIcon | sanitizeHtml"></div>
                        &nbsp;{{ authClient.name }}
                    </a>
                </div>
            </div>

            <!-- Footer with privacy policy. -->
            <app-footer></app-footer>
        </div>
    </div>
</div>